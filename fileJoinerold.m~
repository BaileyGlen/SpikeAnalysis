function [joinedMCD] = fileJoiner(filenameTXT)
%fileJoiner Joins spikesorting TXT and MCD
%   This version currently requires a header. For the header Cell and
%   delimiter, you can leave these empty []

% if isempty(headerCell)
headerCell = {'Channel','Unit','Timestamp'};
% end
% if isempty(delimiter)
delimiter = ',';
% end

% fileID = fopen(filenameTXT,'r');
% assert(fileID>=3, 'Did not Open Correctly');
% temptext = strsplit(fgetl(fileID),delimiter);
% headerList = parseHeader(temptext, headerCell);
%
%     function list = parseHeader(fileHeaders, templateHeaders)
%         list = cellfun(@(x) find(strcmp(x,fileHeaders)),templateHeaders, ...
%             'UniformOutput', false);
%         assert(~isempty(list), ...
%             ['Not all templateHeaders were found in the fileHeader.' ...
%             'Is there a header?']);

% Read it all in

spikeDataset = importSpikesTXT(filenameTXT, 2);

% Resort by headerList - may need to add later
% textIn = textIn(cell2mat(headerList),:);



    function spikeDataset = importSpikesTXT(filename, startRow, endRow)
        %importSpikesTXT Import numeric data from a text file as a matrix.
        %   spikeDataset = importSpikesTXT(FILENAME) Reads data from text file FILENAME for
        %   the default selection.
        %
        %   spikeDataset = importSpikesTXT(FILENAME, STARTROW, ENDROW) Reads data from rows
        %   STARTROW through ENDROW of text file FILENAME.
        %
        % Example:
        %   spikeDataset = importSpikesTXT('2014-12-12_M16_RRRI_01.txt', 2, 327875);
        %
        %    See also TEXTSCAN.
        
        % Auto-generated by MATLAB on 2016/03/18 09:56:46
        
        %% Initialize variables.
        delimiter = ',';
        if nargin<=2
            startRow = 2;
            endRow = inf;
        end
        
        %% Format string for each line of text:
        %   column1: double (%f)
        %	column2: double (%f)
        %   column3: double (%f)
        % For more information, see the TEXTSCAN documentation.
        formatSpec = '%f%f%f%[^\n\r]';
        
        %% Open the text file.
        fileID = fopen(filename,'r');
        
        %% Read columns of data according to format string.
        % This call is based on the structure of the file used to generate this
        % code. If an error occurs for a different file, try regenerating the code
        % from the Import Tool.
        dataArray = textscan(fileID, formatSpec, endRow(1)-startRow(1)+1, 'Delimiter', delimiter, 'EmptyValue' ,NaN,'HeaderLines', startRow(1)-1, 'ReturnOnError', false);
        for block=2:length(startRow)
            frewind(fileID);
            dataArrayBlock = textscan(fileID, formatSpec, endRow(block)-startRow(block)+1, 'Delimiter', delimiter, 'EmptyValue' ,NaN,'HeaderLines', startRow(block)-1, 'ReturnOnError', false);
            for col=1:length(dataArray)
                dataArray{col} = [dataArray{col};dataArrayBlock{col}];
            end
        end
        
        %% Close the text file.
        fclose(fileID);
        
        %% Post processing for unimportable data.
        % No unimportable data rules were applied during the import, so no post
        % processing code is included. To generate code which works for
        % unimportable data, select unimportable cells in a file and regenerate the
        % script.
        
        %% Create output variable
        spikeDataset = dataset(dataArray{1:end-1}, 'VarNames', {'Channel','Unit','Timestamp'});
        
    end
end